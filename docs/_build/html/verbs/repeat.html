


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Retry &mdash; Scala Words - Documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Exo:300,400,600,700" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toc.js"></script>
    <script type="text/javascript" src="../_static/prettify.js"></script>
    <script type="text/javascript" src="../_static/highlightCode.js"></script>
    <script type="text/javascript" src="../_static/effects.core.js"></script>
    <script type="text/javascript" src="../_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../_static/scrollTo.js"></script>
    <script type="text/javascript" src="../_static/contentsFix.js"></script>
    <script type="text/javascript" src="../_static/ga.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Scala Words - Documentation" href="../index.html" />
    <link rel="up" title="Verbs" href="index.html" />
    <link rel="next" title="Timed" href="timed.html" />
    <link rel="prev" title="Do To" href="do-to.html" />

  </head>
  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <div class="navbar-logo">
        </div>    
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title" style="padding-top:0.75em">
        <a href="../index.html" style="color: white; background: url(../_static/logo-small.png) no-repeat; height: 40px; padding-left: 62px; padding-top: 1em; margin-top: 1em; padding-bottom: 0.5em">
        <span style="padding-bottom: 1em">Retry
        </a>
      </div>
      <div class="pdf-link"><a href="../ScalaSlides.pdf"><img src="../_static/pdf-icon.png" style="height: 40px;" /></a></div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <ul class="breadcrumb">           
              <li>
                 <span class="divider">|</span> <a href="timed.html">Timed</a> <span class="divider">»</span>
              </li>
              <li>
                <a href="../index.html">Contents</a>
              </li>
              <li>
                <span class="divider">«</span> <a href="do-to.html">Do To</a> <span class="divider">|</span>
              </li>
              <li>
                Version 0.1
              </li>
            </ul>         
          </div>
        </div>
        <div class="row">
          <div class="span9">
            
  <div class="section" id="retry">
<h1>Retry</h1>
<div class="section" id="use-case">
<h2>Use Case</h2>
<p>You want to retry a certain operation which may fail. An example would be making a request to some webservice, which like to timeout once a while and a retry will successfully processa after such failure.</p>
<p>You want to perform some operation multiple times.</p>
</div>
<div class="section" id="retry-some-operation">
<h2>Retry some operation</h2>
<p>The most basic use is to try something up to 3 times:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Example</span> <span class="k">extends</span> <span class="nc">App</span> <span class="k">with</span> <span class="nc">RetryVerb</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">res</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">Throwable</span><span class="o">]</span>, <span class="kt">Source</span><span class="o">]</span> <span class="k">=</span> <span class="n">retry</span><span class="o">(</span><span class="n">times</span> <span class="k">=</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURI</span><span class="o">(</span><span class="s">&quot;http://www.example.com&quot;</span><span class="o">)</span>
  <span class="o">}</span>

 <span class="n">res</span> <span class="k">match</span> <span class="o">{</span>
   <span class="k">case</span> <span class="nc">Left</span><span class="o">(</span><span class="n">errors</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">errors</span> <span class="n">foreach</span> <span class="o">{</span> <span class="n">err</span> <span class="k">=&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="s">&quot;failed with: &quot;</span> <span class="o">+</span> <span class="n">err</span><span class="o">)</span> <span class="o">}</span>
   <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="n">source</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;We got the source!&quot;</span><span class="o">)</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that if the block of code will complete without errors the first time around, retry will not call it again.
Another thing to note is, that if the block failed only the first time, the <tt class="docutils literal"><span class="pre">Either</span></tt> will not contain errors - it&#8217;s an Either - so it either failed (3 times) or you got your expected result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In idiomatic Scala code, <tt class="docutils literal"><span class="pre">Left</span></tt> is considered as the &#8220;errors&#8221; side of an <tt class="docutils literal"><span class="pre">Either</span></tt> and <tt class="docutils literal"><span class="pre">Right</span></tt> is the expected value. Scala Words follows this convention wherever an Either is used. For more details, check out this link: <a class="reference external" href="http://www.scala-lang.org/api/current/index.html#scala.Either">http://www.scala-lang.org/api/current/index.html#scala.Either</a></p>
</div>
</div>
<div class="section" id="simple-tip-how-to-treat-either-as-option">
<h2>Simple tip, how to treat Either as Option</h2>
<p>If you don&#8217;t care about the exceptions being thrown, you can simply map over the <em>right value</em>.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">exceptionsOrString</span> <span class="k">=</span> <span class="n">retry</span><span class="o">(</span><span class="n">times</span> <span class="k">=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span> <span class="s">&quot;Hello&quot;</span> <span class="o">}</span>
<span class="n">exceptionsOrString</span><span class="o">.</span><span class="n">right</span> <span class="n">map</span> <span class="o">{</span> <span class="n">println</span> <span class="o">(</span><span class="s">&quot;Got : &quot;</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span> <span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reacting-to-failures">
<h2>Reacting to failures</h2>
<p>Since you may be interested in the faulilures, <tt class="docutils literal"><span class="pre">Retry</span></tt> has a callback you can define to get this info:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="c1">// with UnlessWord</span>

<span class="k">val</span> <span class="n">onException</span> <span class="k">=</span> <span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">willRetry</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">,</span> <span class="n">ex</span><span class="k">:</span> <span class="kt">Throwable</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Oh no! Failed %sth time, and will %sretry: %s&quot;</span>
    <span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="s">&quot;NOT &quot;</span><span class="o">.</span><span class="n">unless</span><span class="o">(</span><span class="n">willRetry</span><span class="o">),</span> <span class="n">ex</span><span class="o">.</span><span class="n">getMessage</span><span class="o">))</span>
<span class="o">}</span>

<span class="n">retry</span><span class="o">(</span>
  <span class="n">times</span> <span class="k">=</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">onException</span> <span class="k">=</span> <span class="n">onException</span>
<span class="o">)</span> <span class="o">{</span> <span class="n">doThings</span><span class="o">()</span> <span class="o">}</span>
</pre></div>
</div>
<p>Which, as expected, will call <tt class="docutils literal"><span class="pre">onException</span></tt>  whenever doThings throws an exception.</p>
</div>
<div class="section" id="other-hooks-beforeeach-and-onsuccess">
<h2>Other hooks: beforeEach and onSuccess</h2>
<p>These methods give you information about the state of processing the <tt class="docutils literal"><span class="pre">Retry</span></tt>.
You may for example use the <tt class="docutils literal"><span class="pre">beforeEach</span></tt> hook to log information like &#8220;retrying for the nth time...&#8221;,
or do something else with the number of retries given to this function.</p>
<p>Similarily, onSuccess would be used to log the number of retries that were used to obtain the value.
It will not be called when all calls caused an exception - then onException will be notified for each of them, and the retult will be an <tt class="docutils literal"><span class="pre">Left[Seq[Exception]]</span></tt>.</p>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"></div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>ScalaWords</h5></li>
      <li><a href="http://ktoso.github.com/scala-words">Documentation</a></li>
      <li><a href="http://blog.project13.pl">Blog</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="http://github.com/ktoso/scala-words">Source Code</a></li>
    </ul>
    <ul>
      <li><img src="../_static/watermark.png" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p style="float: left;">
      © 2012 <a href="http://blog.project13.pl">Project13.pl</a> <span class="license">ScalaWords is Open Source and available under the Apache 2 License.</span>
    </p>
    <p style="float: right; font-size: 12px;">
      Last updated: Aug 04, 2012
    </p>
  </div>
</div>
<script type="text/javascript">
  $('#toc').toc();
</script>
  

  </body>
</html>